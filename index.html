<!DOCTYPE html>
<html lang="zh-TW">
  Â 
  <head>
    Â  Â 
    <meta charset="UTF-8" />
    Â  Â 
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    Â  Â 
    <title>å¾Œå±±é¢¨é›²éœ²</title>
    Â  Â 
    <link rel="icon" type="image/png" href="./icon-v2.png" />
    Â  Â 
    <link rel="apple-touch-icon" href="./icon-v2.png" />
    Â  Â 
    <link rel="apple-touch-icon" sizes="180x180" href="./icon-v2.png" />
    Â  Â 
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    Â  Â 
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    Â  Â 
    <link
      href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap"
      rel="stylesheet"
    />

    Â  Â 
    <style>
      Â  Â  Â  :root {
      Â  Â  Â  Â  --ac-green: #7de1a9;
      Â  Â  Â  Â  --ac-bg-pattern: #8fd8af;
      Â  Â  Â  Â  --ac-cream: #fffef2;
      Â  Â  Â  Â  --ac-yellow: #f9f195;
      Â  Â  Â  Â  --ac-brown: #796452;
      Â  Â  Â  Â  --ac-blue: #4fb5d9;
      Â  Â  Â  Â  --ac-dark: #58504a;
      Â  Â  Â  Â  --ac-card-border: #e6e0c8;
      Â  Â  Â  }

      Â  Â  Â  * {
      Â  Â  Â  Â  margin: 0;
      Â  Â  Â  Â  padding: 0;
      Â  Â  Â  Â  box-sizing: border-box;
      Â  Â  Â  Â  -webkit-tap-highlight-color: transparent;
      Â  Â  Â  }

      Â  Â  Â  body {
      Â  Â  Â  Â  font-family: "Zen Maru Gothic", sans-serif;
      Â  Â  Â  Â  background-color: var(--ac-green);
      Â  Â  Â  Â  /* æ›´ç´°ç·»çš„æ–œç´‹èƒŒæ™¯ */
      Â  Â  Â  Â  background-image: repeating-linear-gradient(
      Â  Â  Â  Â  Â  45deg,
      Â  Â  Â  Â  Â  transparent,
      Â  Â  Â  Â  Â  transparent 20px,
      Â  Â  Â  Â  Â  rgba(255, 255, 255, 0.2) 20px,
      Â  Â  Â  Â  Â  rgba(255, 255, 255, 0.2) 40px
      Â  Â  Â  Â  );
      Â  Â  Â  Â  min-height: 100vh;
      Â  Â  Â  Â  color: var(--ac-dark);
      Â  Â  Â  Â  /* é˜²æ­¢ iOS å·¦å³æ»‘å‹• */
      Â  Â  Â  Â  overflow-x: hidden;
      Â  Â  Â  Â  padding-bottom: 20px;
      Â  Â  Â  }

      Â  Â  Â  /* é ‚éƒ¨ç‹€æ…‹åˆ— (åŸå§‹çš„å…©é …ä½ˆå±€) */
      Â  Â  Â  .status-bar {
      Â  Â  Â  Â  display: flex;
      Â  Â  Â  Â  justify-content: space-between;
      Â  Â  Â  Â  align-items: center;
      Â  Â  Â  Â  padding: 15px 20px;
      Â  Â  Â  Â  background: rgba(255, 255, 255, 0.3);
      Â  Â  Â  Â  backdrop-filter: blur(10px);
      Â  Â  Â  Â  position: sticky;
      Â  Â  Â  Â  top: 0;
      Â  Â  Â  Â  z-index: 100;
      Â  Â  Â  }

      Â  Â  Â  .location-pill {
      Â  Â  Â  Â  background: var(--ac-yellow);
      Â  Â  Â  Â  color: var(--ac-brown);
      Â  Â  Â  Â  padding: 5px 15px;
      Â  Â  Â  Â  border-radius: 20px;
      Â  Â  Â  Â  font-weight: 900;
      Â  Â  Â  Â  font-size: 1.1rem;
      Â  Â  Â  Â  transform: rotate(-2deg);
      Â  Â  Â  Â  border: 2px solid white;
      Â  Â  Â  Â  box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.1);
      Â  Â  Â  }

      Â  Â  Â  .update-pill {
      Â  Â  Â  Â  font-size: 0.8rem;
      Â  Â  Â  Â  color: white;
      Â  Â  Â  Â  background: rgba(0, 0, 0, 0.2);
      Â  Â  Â  Â  padding: 4px 10px;
      Â  Â  Â  Â  border-radius: 12px;
      Â  Â  Â  }

      Â  Â  Â  /* === ä¿ç•™ï¼šç¨ç«‹åŠŸèƒ½å€å¡Šæ¨£å¼ (æ™‚è¨Š/åœ–è¡¨) === */
      Â  Â  Â  .function-block {
      Â  Â  Â  Â  background: var(--ac-cream);
      Â  Â  Â  Â  border-radius: 20px;
      Â  Â  Â  Â  padding: 15px 20px;
      Â  Â  Â  Â  box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
      Â  Â  Â  Â  border: 3px solid var(--ac-card-border);
      Â  Â  Â  Â  margin-bottom: 20px;
      Â  Â  Â  Â  text-align: center;
      Â  Â  Â  }

      Â  Â  Â  .block-title {
      Â  Â  Â  Â  font-size: 1.1rem;
      Â  Â  Â  Â  font-weight: 700;
      Â  Â  Â  Â  color: var(--ac-blue);
      Â  Â  Â  Â  margin-bottom: 10px;
      Â  Â  Â  Â  padding-bottom: 5px;
      Â  Â  Â  Â  border-bottom: 1px dashed var(--ac-card-border);
      Â  Â  Â  }

      Â  Â  Â  .block-content {
      Â  Â  Â  Â  display: flex;
      Â  Â  Â  Â  flex-direction: column;
      Â  Â  Â  Â  align-items: center;
      Â  Â  Â  Â  justify-content: center;
      Â  Â  Â  Â  color: var(--ac-dark);
      Â  Â  Â  Â  /* ç¢ºä¿åœ–è¡¨ä¸æœƒè¢«éš±è— */
      Â  Â  Â  Â  overflow: hidden;
      Â  Â  Â  }

      Â  Â  Â  .block-content .time-display {
      Â  Â  Â  Â  font-size: 1.8rem;
      Â  Â  Â  Â  font-weight: 900;
      Â  Â  Â  Â  line-height: 1;
      Â  Â  Â  Â  margin-bottom: 3px;
      Â  Â  Â  }

      Â  Â  Â  .block-content .date-display {
      Â  Â  Â  Â  font-size: 1rem;
      Â  Â  Â  Â  opacity: 0.8;
      Â  Â  Â  }

      Â  Â  Â  /* é™é›¨åœ–è¡¨ç‰¹æœ‰æ¨£å¼ */
      Â  Â  Â  #rainChart {
      Â  Â  Â  Â  /* ä½¿ç”¨å‹•æ£®é¢¨æ ¼çš„ç¶ è‰²ä½œç‚ºé™é›¨è¶¨å‹¢çš„é¡è‰² */
      Â  Â  Â  Â  --rain-color: var(--ac-green);
      Â  Â  Â  }
      Â  Â  Â  /* ========================================= */

      Â  Â  Â  .container {
      Â  Â  Â  Â  padding: 20px;
      Â  Â  Â  Â  max-width: 600px;
      Â  Â  Â  Â  /* é™åˆ¶åœ¨å¤§æ‰‹æ©Ÿå¯¬åº¦ */
      Â  Â  Â  Â  margin: 0 auto;
      Â  Â  Â  }

      Â  Â  Â  /* === æ ¸å¿ƒï¼šä»Šæ—¥ç„¦é»å¡ç‰‡ === */
      Â  Â  Â  .hero-card {
      Â  Â  Â  Â  background: var(--ac-cream);
      Â  Â  Â  Â  border-radius: 35px;
      Â  Â  Â  Â  padding: 30px 25px;
      Â  Â  Â  Â  text-align: center;
      Â  Â  Â  Â  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      Â  Â  Â  Â  border: 4px solid white;
      Â  Â  Â  Â  margin-bottom: 25px;
      Â  Â  Â  Â  position: relative;
      Â  Â  Â  }

      Â  Â  Â  /* åƒå‹•æ£®çš„å°è©±æ°£æ³¡ */
      Â  Â  Â  .hero-period {
      Â  Â  Â  Â  position: absolute;
      Â  Â  Â  Â  top: -15px;
      Â  Â  Â  Â  left: 50%;
      Â  Â  Â  Â  transform: translateX(-50%);
      Â  Â  Â  Â  background: var(--ac-blue);
      Â  Â  Â  Â  color: white;
      Â  Â  Â  Â  padding: 5px 20px;
      Â  Â  Â  Â  border-radius: 20px;
      Â  Â  Â  Â  font-weight: bold;
      Â  Â  Â  Â  border: 3px solid white;
      Â  Â  Â  Â  box-shadow: 0 4px 0 rgba(0, 0, 0, 0.1);
      Â  Â  Â  }

      Â  Â  Â  .hero-temp-container {
      Â  Â  Â  Â  display: flex;
      Â  Â  Â  Â  justify-content: center;
      Â  Â  Â  Â  align-items: center;
      Â  Â  Â  Â  gap: 10px;
      Â  Â  Â  Â  margin: 15px 0;
      Â  Â  Â  }

      Â  Â  Â  .hero-icon {
      Â  Â  Â  Â  font-size: 5rem;
      Â  Â  Â  Â  filter: drop-shadow(0 4px 0 rgba(0, 0, 0, 0.1));
      Â  Â  Â  Â  animation: bounce 3s infinite;
      Â  Â  Â  }

      Â  Â  Â  @keyframes bounce {
      Â  Â  Â  Â  0%,
      Â  Â  Â  Â  100% {
      Â  Â  Â  Â  Â  transform: translateY(0);
      Â  Â  Â  Â  }

      Â  Â  Â  Â  50% {
      Â  Â  Â  Â  Â  transform: translateY(-10px);
      Â  Â  Â  Â  }
      Â  Â  Â  }

      Â  Â  Â  .hero-temp {
      Â  Â  Â  Â  font-size: 4.5rem;
      Â  Â  Â  Â  font-weight: 900;
      Â  Â  Â  Â  color: var(--ac-brown);
      Â  Â  Â  Â  line-height: 1;
      Â  Â  Â  }

      Â  Â  Â  .hero-desc {
      Â  Â  Â  Â  font-size: 1.5rem;
      Â  Â  Â  Â  color: #8a7b70;
      Â  Â  Â  Â  margin-bottom: 20px;
      Â  Â  Â  Â  font-weight: bold;
      Â  Â  Â  }

      Â  Â  Â  /* === ä¸Šç­æ—æœ€æ„›çš„ï¼šå¿«é€Ÿå»ºè­°å€ === */
      Â  Â  Â  .advice-grid {
      Â  Â  Â  Â  display: grid;
      Â  Â  Â  Â  grid-template-columns: 1fr 1fr;
      Â  Â  Â  Â  gap: 15px;
      Â  Â  Â  Â  margin-top: 20px;
      Â  Â  Â  Â  padding-top: 20px;
      Â  Â  Â  Â  border-top: 2px dashed #e0d8c0;
      Â  Â  Â  }

      Â  Â  Â  .advice-item {
      Â  Â  Â  Â  display: flex;
      Â  Â  Â  Â  flex-direction: column;
      Â  Â  Â  Â  align-items: center;
      Â  Â  Â  Â  background: rgba(255, 255, 255, 0.5);
      Â  Â  Â  Â  padding: 10px;
      Â  Â  Â  Â  border-radius: 20px;
      Â  Â  Â  }

      Â  Â  Â  .advice-icon {
      Â  Â  Â  Â  font-size: 2rem;
      Â  Â  Â  Â  margin-bottom: 5px;
      Â  Â  Â  }

      Â  Â  Â  .advice-text {
      Â  Â  Â  Â  font-size: 1.4rem;
      Â  Â  Â  Â  font-weight: 900;
      Â  Â  Â  Â  color: var(--ac-brown);
      Â  Â  Â  Â  margin: 5px 0;
      Â  Â  Â  Â  line-height: 1.2;
      Â  Â  Â  }

      Â  Â  Â  /* === ç¨å¾Œé å ±ï¼šæ©«å‘æ»‘å‹•å€ === */
      Â  Â  Â  .section-title {
      Â  Â  Â  Â  font-size: 1.2rem;
      Â  Â  Â  Â  color: white;
      Â  Â  Â  Â  margin-bottom: 15px;
      Â  Â  Â  Â  margin-left: 10px;
      Â  Â  Â  Â  font-weight: 900;
      Â  Â  Â  Â  text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.1);
      Â  Â  Â  }

      Â  Â  Â  .scroll-container {
      Â  Â  Â  Â  display: flex;
      Â  Â  Â  Â  overflow-x: auto;
      Â  Â  Â  Â  gap: 15px;
      Â  Â  Â  Â  padding-bottom: 10px;
      Â  Â  Â  Â  /* éš±è—æ»¾å‹•æ¢ä½†ä¿ç•™åŠŸèƒ½ */
      Â  Â  Â  Â  scrollbar-width: none;
      Â  Â  Â  Â  -ms-overflow-style: none;
      Â  Â  Â  }

      Â  Â  Â  .scroll-container::-webkit-scrollbar {
      Â  Â  Â  Â  display: none;
      Â  Â  Â  }

      Â  Â  Â  .mini-card {
      Â  Â  Â  Â  min-width: 140px;
      Â  Â  Â  Â  background: rgba(255, 255, 255, 0.85);
      Â  Â  Â  Â  border-radius: 25px;
      Â  Â  Â  Â  padding: 20px 15px;
      Â  Â  Â  Â  text-align: center;
      Â  Â  Â  Â  border: 3px solid white;
      Â  Â  Â  Â  flex-shrink: 0;
      Â  Â  Â  Â  /* é˜²æ­¢è¢«æ“ å£“ */
      Â  Â  Â  }

      Â  Â  Â  .mini-time {
      Â  Â  Â  Â  background: var(--ac-green);
      Â  Â  Â  Â  color: white;
      Â  Â  Â  Â  padding: 3px 10px;
      Â  Â  Â  Â  border-radius: 10px;
      Â  Â  Â  Â  font-size: 0.8rem;
      Â  Â  Â  Â  display: inline-block;
      Â  Â  Â  Â  margin-bottom: 10px;
      Â  Â  Â  Â  font-weight: bold;
      Â  Â  Â  }

      Â  Â  Â  .mini-icon {
      Â  Â  Â  Â  font-size: 2.5rem;
      Â  Â  Â  Â  margin: 5px 0;
      Â  Â  Â  }

      Â  Â  Â  .mini-temp {
      Â  Â  Â  Â  font-size: 1.2rem;
      Â  Â  Â  Â  font-weight: 800;
      Â  Â  Â  Â  color: var(--ac-dark);
      Â  Â  Â  }

      Â  Â  Â  /* Loading ç•«é¢ */
      Â  Â  Â  .loading-screen {
      Â  Â  Â  Â  position: fixed;
      Â  Â  Â  Â  top: 0;
      Â  Â  Â  Â  left: 0;
      Â  Â  Â  Â  right: 0;
      Â  Â  Â  Â  bottom: 0;
      Â  Â  Â  Â  background: var(--ac-green);
      Â  Â  Â  Â  display: flex;
      Â  Â  Â  Â  flex-direction: column;
      Â  Â  Â  Â  justify-content: center;
      Â  Â  Â  Â  align-items: center;
      Â  Â  Â  Â  z-index: 999;
      Â  Â  Â  }
      Â  Â 
    </style>
    Â 
  </head>

  Â 
  <body>
    Â  Â 
    <div id="loading" class="loading-screen">
      Â  Â  Â 
      <div style="font-size: 4rem; animation: bounce 2s infinite">â˜ï¸</div>
      Â  Â  Â 
      <p style="color: white; font-weight: bold; margin-top: 20px">
        Â  Â  Â  Â  æ­£åœ¨è§€æ¸¬å¾Œå±±é›²çš„æµå‹•... Â  Â  Â 
      </p>
      Â  Â 
    </div>
    Â  Â 
    <div class="status-bar">
      Â  Â  Â 
      <div class="location-pill">ğŸ“ å¾Œå±±</div>
      Â  Â  Â 
      <div id="updateTime" class="update-pill">æ›´æ–°ä¸­...</div>
      Â  Â 
    </div>

    Â  Â 
    <div class="container" id="mainContent" style="display: none">
      Â  Â  Â 
      <div id="dateTimeBlock" class="function-block">
        Â  Â  Â  Â 
        <div class="block-title">ğŸ“… å¾Œå±±æ™‚è¨Š</div>
        Â  Â  Â  Â 
        <div id="dateTimePill" class="block-content"></div>
        Â  Â  Â 
      </div>

      Â  Â  Â 
      <div id="heroCard"></div>

      Â  Â  Â 
      <h3 class="section-title">ç¨å¾Œé å ±</h3>
      Â  Â  Â 
      <div class="scroll-container" id="futureForecasts"></div>

      Â  Â  Â 
      <div id="rainChartBlock" class="function-block" style="margin-top: 25px">
        Â  Â  Â  Â 
        <div class="block-title">ğŸ’§ é™é›¨è¶¨å‹¢åˆ†æ</div>
        Â  Â  Â  Â 
        <div class="block-content">
          Â  Â  Â  Â  Â 
          <canvas
            id="rainChart"
            width="500"
            height="150"
            style="max-width: 100%"
          ></canvas>
          Â  Â  Â  Â  Â 
          <div
            id="rainChartLegend"
            style="font-size: 0.9rem; margin-top: 10px; color: var(--ac-dark)"
          ></div>
          Â  Â  Â  Â 
        </div>
        Â  Â  Â 
      </div>
      Â  Â 
    </div>

    Â  Â 
    <script>
      const API_URL = "https://vibe-cwa-api.zeabur.app/api/weather/taitung";

      function getWeatherIcon(weather) {
        if (!weather) return "ğŸŒ¤ï¸";
        if (weather.includes("æ™´")) return "â˜€ï¸";
        if (weather.includes("å¤šé›²")) return "â›…";
        if (weather.includes("é™°")) return "â˜ï¸";
        if (weather.includes("é›¨")) return "ğŸŒ§ï¸";
        if (weather.includes("é›·")) return "â›ˆï¸";
        return "ğŸŒ¤ï¸";
      }

      function getAdvice(rainProb, maxTemp) {
        let rainIcon = "ğŸŒ‚";
        let rainText = "ä¸ç”¨å¸¶å‚˜";
        if (parseInt(rainProb) > 30) {
          rainIcon = "â˜‚ï¸";
          rainText = "è¨˜å¾—å¸¶å‚˜ï¼";
        }

        let clothIcon = "ğŸ‘•";
        let clothText = "èˆ’é©ç©¿æ­";
        if (parseInt(maxTemp) >= 28) {
          clothIcon = "ğŸ½";
          clothText = "çŸ­è¢–å‡ºç™¼";
        } else if (parseInt(maxTemp) <= 20) {
          clothIcon = "ğŸ§¥";
          clothText = "åŠ ä»¶å¤–å¥—";
        }

        return { rainIcon, rainText, clothIcon, clothText };
      }

      function getTimePeriod(startTime) {
        const hour = new Date(startTime).getHours();
        if (hour >= 5 && hour < 11) return "æ—©æ™¨";
        if (hour >= 11 && hour < 14) return "ä¸­åˆ";
        if (hour >= 14 && hour < 18) return "ä¸‹åˆ";
        if (hour >= 18 && hour < 23) return "æ™šä¸Š";
        return "æ·±å¤œ";
      }

      function updateClockAndDate() {
        const now = new Date();
        const dateTimePill = document.getElementById("dateTimePill");

        const time = now.toLocaleTimeString("zh-TW", {
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
          hour12: false,
          timeZone: "Asia/Taipei",
        });

        const dateString = now.toLocaleDateString("zh-TW", {
          month: "2-digit",
          day: "2-digit",
          weekday: "short",
          timeZone: "Asia/Taipei",
        });

        let lunarDate = "è¾²æ›†è¼‰å…¥ä¸­";
        try {
          const lunarDateFull = now.toLocaleDateString("zh-TW-u-ca-chinese", {
            year: "numeric",
            month: "long",
            day: "numeric",
            timeZone: "Asia/Taipei",
          });

          const lunarDateMatch = lunarDateFull.match(/å¹´(.+)/);
          lunarDate = lunarDateMatch ? lunarDateMatch[1] : lunarDateFull;
        } catch (e) {
          lunarDate = "è¾²æ›†è³‡è¨Šä¸å¯ç”¨";
        } // çµ„åˆé¡¯ç¤º

        dateTimePill.innerHTML = `
Â  Â  Â  Â  Â  Â  <div class="time-display">${time}</div>
Â  Â  Â  Â  Â  Â  <div class="date-display">${lunarDate} (${dateString})</div>
Â  Â  Â  Â  `;
      } // === æ–°å¢ï¼šç¹ªè£½é™é›¨æ³¢æ®µåœ–çš„å‡½å¼ ===

      function drawRainChart(forecasts) {
        const canvas = document.getElementById("rainChart");
        if (!canvas) return;

        const ctx = canvas.getContext("2d"); // ç¢ºä¿åœ¨é‡æ–°ç¹ªè£½æ™‚æ¸…é™¤ä¸Šæ¬¡çš„å…§å®¹

        const WIDTH = canvas.width;
        const HEIGHT = canvas.height;
        ctx.clearRect(0, 0, WIDTH, HEIGHT); // é™åˆ¶åªå–æœªä¾† 6 å€‹æ™‚æ®µçš„æ•¸æ“š (åŒ…å«ç•¶å‰æ™‚æ®µ)

        const data = forecasts.slice(0, 6).map((f) => ({
          rain: parseInt(f.rain),
          hour: new Date(f.startTime).getHours(),
        })); // æ•¸æ“šé»å°‘æ–¼ 2 å€‹å‰‡ä¸ç¹ªè£½

        if (data.length < 2) return;

        const maxValue = 100; // é™é›¨æ©Ÿç‡æœ€å¤§å€¼
        const padding = 20;
        const chartWidth = WIDTH - 2 * padding;
        const chartHeight = HEIGHT - 2 * padding;

        const stepX = chartWidth / (data.length - 1); // é¡è‰²å’Œæ¨£å¼

        const chartColor = getComputedStyle(canvas)
          .getPropertyValue("--ac-green")
          .trim();
        ctx.font = '10px "Zen Maru Gothic"';
        ctx.fillStyle = "var(--ac-dark)";
        ctx.textAlign = "center"; // ç¹ªè£½æ³¢æ®µåœ–

        ctx.beginPath(); // èµ·é» (å·¦ä¸‹è§’)
        ctx.moveTo(padding, HEIGHT - padding);

        let points = [];
        data.forEach((item, i) => {
          const x = padding + i * stepX; // é™é›¨æ©Ÿç‡è¶Šé«˜ï¼Œyå€¼è¶Šä½ (å› ç‚º 0% åœ¨åº•éƒ¨ï¼Œ100% åœ¨é ‚éƒ¨)
          const y = HEIGHT - padding - (item.rain / maxValue) * chartHeight;
          points.push({ x, y, rain: item.rain }); // ç¹ªè£½ç·šæ¢

          ctx.lineTo(x, y);
        }); // çµ‚é» (å³ä¸‹è§’)

        ctx.lineTo(WIDTH - padding, HEIGHT - padding);
        ctx.closePath(); // å¡«å……æ¼¸å±¤ (å‹•æ£®é¢¨æ ¼çš„ç¶ è‰²åˆ°æ·ºç¶ è‰²)

        const gradient = ctx.createLinearGradient(0, 0, 0, HEIGHT);
        gradient.addColorStop(0, `rgba(125, 225, 169, 0.7)`); // --ac-green
        gradient.addColorStop(1, `rgba(125, 225, 169, 0.2)`);
        ctx.fillStyle = gradient;
        ctx.fill(); // ç¹ªè£½é‚Šç•Œç·š

        ctx.strokeStyle = chartColor;
        ctx.lineWidth = 3;
        ctx.stroke(); // ç¹ªè£½æ•¸æ“šé»å’Œæ•¸å€¼

        ctx.fillStyle = "var(--ac-dark)";
        points.forEach((p) => {
          // ç•«é™é›¨æ©Ÿç‡æ•¸å€¼
          ctx.fillText(`${p.rain}%`, p.x, p.y - 10); // ç•«åœ“é»

          ctx.beginPath();
          ctx.arc(p.x, p.y, 4, 0, Math.PI * 2);
          ctx.fillStyle = chartColor;
          ctx.fill();
          ctx.strokeStyle = "white";
          ctx.lineWidth = 2;
          ctx.stroke();
        }); // ç¹ªè£½ X è»¸æ¨™ç±¤ (æ™‚é–“) å’Œåº•éƒ¨é‚Šç•Œ

        ctx.strokeStyle = "#ccc";
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(padding, HEIGHT - padding);
        ctx.lineTo(WIDTH - padding, HEIGHT - padding);
        ctx.stroke();

        let legendHtml = "";
        data.forEach((item, i) => {
          const period = getTimePeriod(new Date().setHours(item.hour)); // é¡¯ç¤ºå°æ™‚æ•¸ 14:00
          const hourString = item.hour.toString().padStart(2, "0") + ":00";
          legendHtml += `<span style="display:inline-block; min-width: 16%;">${
            i === 0 ? "ç¾åœ¨" : hourString
          }</span>`;
        });

        document.getElementById("rainChartLegend").innerHTML = legendHtml;
      } // ===================================
      function renderWeather(data) {
        const forecasts = data.forecasts;

        const current = forecasts[0];
        const others = forecasts.slice(1); // 1. æ¸²æŸ“ Hero Card (ä¸»ç•«é¢) - ä½¿ç”¨ current (ç´¢å¼• 0)

        const advice = getAdvice(current.rain, current.maxTemp);
        const period = getTimePeriod(current.startTime);
        const avgTemp = Math.round(
          (parseInt(current.maxTemp) + parseInt(current.minTemp)) / 2
        );

        document.getElementById("heroCard").innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="hero-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="hero-period">${period}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="hero-temp-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="hero-icon">${getWeatherIcon(
          current.weather
        )}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="hero-temp">${avgTemp}Â°</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="hero-desc">${current.weather}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="advice-grid">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="advice-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="advice-icon">${
          advice.rainIcon
        }</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="advice-text">${
          advice.rainText
        }</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:0.7rem; color:#999">é™é›¨ç‡ ${
          current.rain
        }</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="advice-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="advice-icon">${
          advice.clothIcon
        }</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="advice-text">${
          advice.clothText
        }</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:0.7rem; color:#999">æœ€é«˜æº« ${
          current.maxTemp
        }Â°</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `; // 2. æ¸²æŸ“ç¨å¾Œé å ±

        const scrollContainer = document.getElementById("futureForecasts");
        scrollContainer.innerHTML = "";

        const todayDate = new Date().getDate(); // éæ­· others (ç´¢å¼• 1 ä¹‹å¾Œçš„è³‡æ–™)

        others.forEach((f) => {
          let p = getTimePeriod(f.startTime); // åˆ¤æ–·è©²é å ±çš„æ—¥æœŸæ˜¯å¦è·Ÿä»Šå¤©ä¸åŒï¼Œä¸åŒå°±æ˜¯æ˜å¤©

          const fDate = new Date(f.startTime);
          if (fDate.getDate() !== todayDate) {
            p = "æ˜å¤©" + p;
          }

          scrollContainer.innerHTML += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mini-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mini-time">${p}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mini-icon">${getWeatherIcon(
            f.weather
          )}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mini-temp">${f.minTemp}Â° - ${
            f.maxTemp
          }Â°</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:0.8rem; color:#888; margin-top:5px;">ğŸ’§${
            f.rain
          }</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
        }); // 3. ç¹ªè£½é™é›¨åœ–è¡¨ (æ–°å¢èª¿ç”¨)

        drawRainChart(forecasts); // 4. å³ä¸Šè§’é¡¯ç¤ºä»Šæ—¥æ—¥æœŸ

        const now = new Date();
        const month = now.getMonth() + 1;
        const date = now.getDate();
        const dayIndex = now.getDay();
        const days = ["é€±æ—¥", "é€±ä¸€", "é€±äºŒ", "é€±ä¸‰", "é€±å››", "é€±äº”", "é€±å…­"];

        document.getElementById(
          "updateTime"
        ).textContent = `${month}æœˆ${date}æ—¥ ${days[dayIndex]}`;
      }

      async function fetchWeather() {
        try {
          // 1. å®šç¾©ã€Œæœ€ä½ç­‰å¾…æ™‚é–“ã€ï¼š1500 æ¯«ç§’ (1.5ç§’)
          const delayPromise = new Promise((resolve) =>
            setTimeout(resolve, 1500)
          ); // 2. å®šç¾©ã€ŒæŠ“å–è³‡æ–™ã€çš„å·¥ä½œ

          const fetchPromise = fetch(API_URL).then((res) => res.json()); // 3. Promise.all æœƒç­‰å¾…ã€Œå…©å€‹éƒ½å®Œæˆã€æ‰æœƒå¾€ä¸‹èµ°

          const [_, json] = await Promise.all([delayPromise, fetchPromise]);

          if (json.success) {
            renderWeather(json.data); // è³‡æ–™è™•ç†å¥½å¾Œï¼Œéš±è— Loadingï¼Œé¡¯ç¤ºä¸»ç•«é¢

            document.getElementById("loading").style.display = "none";
            document.getElementById("mainContent").style.display = "block";
          } else {
            throw new Error("API Error");
          }
        } catch (e) {
          console.error(e);
          alert("å¤©æ°£è³‡æ–™è®€å–å¤±æ•—ï¼Œç‹¸å…‹æŠŠç¶²è·¯ç·šå’¬æ–·äº†ï¼");
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        fetchWeather(); // é¦–æ¬¡åŸ·è¡Œæ™‚é˜ï¼Œä¸¦è¨­å®šæ¯ç§’æ›´æ–°

        updateClockAndDate();
        setInterval(updateClockAndDate, 1000);
      });
    </script>
    Â 
  </body>
</html>
